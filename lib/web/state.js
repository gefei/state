var state=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JSONSerializer=e.Visitor=e.Instance=e.Transition=e.PseudoState=e.State=e.Region=e.Vertex=e.NamedElement=e.TransitionKind=e.PseudoStateKind=e.random=e.log=void 0;var n=i(3);Object.defineProperty(e,"log",{enumerable:!0,get:function(){return n.log}});var r=i(1);Object.defineProperty(e,"random",{enumerable:!0,get:function(){return r.random}});var s=i(4);Object.defineProperty(e,"PseudoStateKind",{enumerable:!0,get:function(){return s.PseudoStateKind}});var o=i(2);Object.defineProperty(e,"TransitionKind",{enumerable:!0,get:function(){return o.TransitionKind}});var a=i(5);Object.defineProperty(e,"NamedElement",{enumerable:!0,get:function(){return a.NamedElement}});var u=i(6);Object.defineProperty(e,"Vertex",{enumerable:!0,get:function(){return u.Vertex}});var c=i(7);Object.defineProperty(e,"Region",{enumerable:!0,get:function(){return c.Region}});var d=i(8);Object.defineProperty(e,"State",{enumerable:!0,get:function(){return d.State}});var l=i(9);Object.defineProperty(e,"PseudoState",{enumerable:!0,get:function(){return l.PseudoState}});var h=i(10);Object.defineProperty(e,"Transition",{enumerable:!0,get:function(){return h.Transition}});var f=i(14);Object.defineProperty(e,"Instance",{enumerable:!0,get:function(){return f.Instance}});var g=i(16);Object.defineProperty(e,"Visitor",{enumerable:!0,get:function(){return g.Visitor}});var v=i(17);Object.defineProperty(e,"JSONSerializer",{enumerable:!0,get:function(){return v.JSONSerializer}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.random=void 0,function(t){let e=t=>Math.floor(Math.random()*t);t.get=function(t){return t[e(t.length)]},t.set=function(t){const i=e;return e=t,i}}(e.random||(e.random={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TransitionKind=void 0,function(t){t[t.External=0]="External",t[t.Internal=1]="Internal",t[t.Local=2]="Local"}(e.TransitionKind||(e.TransitionKind={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.log=void 0,function(t){const e=[];t.Create=1,t.Entry=2,t.Exit=4,t.Evaluate=8,t.Transition=16,t.User=128,t.add=function(t,...i){return e.push({consumer:t,category:i.reduce((t,e)=>t|e)})},t.remove=function(t){delete e[t]},t.write=function(t,i){let n;for(const r of e)r&&i&r.category&&r.consumer(n||(n=t()))}}(e.log||(e.log={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PseudoStateKind=void 0,function(t){t[t.Choice=0]="Choice",t[t.DeepHistory=1]="DeepHistory",t[t.Initial=2]="Initial",t[t.Junction=3]="Junction",t[t.ShallowHistory=4]="ShallowHistory"}(e.PseudoStateKind||(e.PseudoStateKind={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NamedElement=void 0;const n=i(0);e.NamedElement=class{constructor(t,e){this.name=t,this.qualifiedName=e?`${e}.${t}`:t,n.log.write(()=>`Created ${this}`,n.log.Create)}*getAncestors(){const t=this.getParent();t&&(yield*t.getAncestors()),yield this}doEnter(t,e,i){this.doEnterHead(t,e,i,void 0),this.doEnterTail(t,e,i)}doEnterHead(t,e,i,r){n.log.write(()=>`${t.instance} enter ${this}`,n.log.Entry)}doExit(t,e,i){n.log.write(()=>`${t.instance} leave ${this}`,n.log.Exit)}toString(){return this.qualifiedName}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vertex=void 0;const n=i(0);class r extends n.NamedElement{constructor(t,e){super(t,e),this.parent=e,this.outgoing=[],this.parent&&this.parent.children.push(this)}getParent(){return this.parent}on(t){return new n.Transition(this).on(t)}when(t){return new n.Transition(this).when(t)}to(t,e=n.TransitionKind.External){if(e===n.TransitionKind.Internal&&t!==this)throw new Error("Internal transitions must have the same source and target states.");return new n.Transition(this).to(t,e)}isActive(t){return void 0===this.parent||t.getVertex(this.parent)===this}evaluate(t,e,i){const n=this.getTransition(i);return!!n&&(n.traverse(t,e,i),!0)}getTransition(t){return this.outgoing.find(e=>e.evaluate(t))}doEnterHead(t,e,i,n){super.doEnterHead(t,e,i,n),t.setVertex(this)}}e.Vertex=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Region=void 0;const n=i(0);class r extends n.NamedElement{constructor(t,e){super(t,e),this.parent=e,this.children=[],e.children.push(this)}getParent(){return this.parent}isComplete(t){const e=t.getState(this);return void 0!==e&&e.isFinal()}doEnterTail(t,e,i){const r=t.getState(this),s=(e||this.initial&&this.initial.isHistory)&&r?r:this.initial,o=e||void 0!==this.initial&&this.initial.kind===n.PseudoStateKind.DeepHistory;s.doEnter(t,o,i)}doExit(t,e,i){const n=t.getVertex(this);n&&n.doExit(t,e,i),super.doExit(t,e,i)}accept(t){t.visitRegion(this);for(const e of this.children)e.accept(t);t.visitRegionTail(this)}}e.Region=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0;const n=i(0);class r extends n.Vertex{constructor(t,e){super(t,e instanceof r?e.getDefaultRegion():e),this.children=[],this.deferrableTriggers=[],this.entryActions=[],this.exitActions=[]}entry(...t){return this.entryActions.push(...t),this}exit(...t){return this.exitActions.push(...t),this}defer(...t){return this.deferrableTriggers.push(...t),this}getDefaultRegion(){return this.defaultRegion||(this.defaultRegion=new n.Region("default",this))}isSimple(){return 0===this.children.length}isComposite(){return this.children.length>0}isOrthogonal(){return this.children.length>1}isFinal(){return 0===this.outgoing.length}isComplete(t){return!this.children.some(e=>!e.isComplete(t))}evaluate(t,e,i){const n=this.delegate(t,e,i)||super.evaluate(t,e,i)||this.deferrable(t,i);return n&&this.completion(t,e),n}delegate(t,e,i){let n=!1;for(let r=0,s=this.children.length;r<s&&this.isActive(t);++r){const s=t.getState(this.children[r]);s&&(n=s.evaluate(t,e,i)||n)}return n}deferrable(t,e){return-1!==this.deferrableTriggers.indexOf(e.constructor)&&(t.instance.defer(e),!0)}getDeferrableTriggers(t){return this.children.reduce((e,i)=>{const n=t.getState(i);return void 0!==n?e.concat(n.getDeferrableTriggers(t)):e},this.deferrableTriggers)}doEnterHead(t,e,i,n){n&&this.children.forEach(r=>{r!==n&&r.doEnter(t,e,i)}),super.doEnterHead(t,e,i,n),t.setState(this),this.entryActions.forEach(e=>e(i,t.instance))}doEnterTail(t,e,i){this.children.forEach(n=>n.doEnter(t,e,i)),this.completion(t,e)}doExit(t,e,i){this.children.forEach(n=>n.doExit(t,e,i)),super.doExit(t,e,i),this.exitActions.forEach(e=>e(i,t.instance))}completion(t,e){this.isComplete(t)&&super.evaluate(t,e,this)}accept(t){t.visitState(this);for(const e of this.children)e.accept(t);t.visitStateTail(this)}}e.State=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PseudoState=void 0;const n=i(1),r=i(0),s=i(2);class o extends r.Vertex{constructor(t,e,i=r.PseudoStateKind.Initial){super(t,e instanceof r.State?e.getDefaultRegion():e),this.kind=i,this.isHistory=this.kind===r.PseudoStateKind.DeepHistory||this.kind===r.PseudoStateKind.ShallowHistory,(this.kind===r.PseudoStateKind.Initial||this.isHistory)&&(this.parent.initial=this)}else(t,e=s.TransitionKind.External){return this.elseTransition=new r.Transition(this).to(t,e).when(()=>!1)}getTransition(t){return(this.kind===r.PseudoStateKind.Choice?n.random.get(this.outgoing.filter(e=>e.evaluate(t))):super.getTransition(t))||this.elseTransition}doEnterTail(t,e,i){this.kind!==r.PseudoStateKind.Junction&&this.evaluate(t,e,i)}accept(t){t.visitPseudoState(this),t.visitPseudoStateTail(this)}}e.PseudoState=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transition=void 0;const n=i(0),r=i(11),s=i(12),o=i(13),a=[];a[n.TransitionKind.External]=r.ExternalTransitionStrategy,a[n.TransitionKind.Internal]=s.InternalTransitionStrategy,a[n.TransitionKind.Local]=o.LocalTransitionStrategy;e.Transition=class{constructor(t){this.source=t,this.guard=()=>!0,this.traverseActions=[],this.target=t,this.strategy=new a[n.TransitionKind.Internal](this.source,this.target),this.source.outgoing.push(this)}on(t){return this.eventType=t,this}when(t){return this.guard=t,this}to(t,e=n.TransitionKind.External){return this.target=t,this.strategy=new a[e](this.source,this.target),this}effect(...t){return this.traverseActions.push(...t),this}evaluate(t){return(void 0===this.eventType||t.constructor===this.eventType)&&this.guard(t)}traverse(t,e,i){var r=this;const s=[r];for(;r.target instanceof n.PseudoState&&r.target.kind===n.PseudoStateKind.Junction;)s.push(r=r.target.getTransition(i));s.forEach(n=>n.execute(t,e,i))}execute(t,e,i){n.log.write(()=>`${t.instance} traverse ${this}`,n.log.Transition),this.strategy.doExitSource(t,e,i),this.traverseActions.forEach(e=>e(i,t.instance)),this.strategy.doEnterTarget(t,e,i)}toString(){return`${this.strategy} transition from ${this.source} to ${this.target}`}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExternalTransitionStrategy=void 0;const n=i(0);e.ExternalTransitionStrategy=class{constructor(t,e){const i=t.getAncestors(),r=e.getAncestors();let s=i.next(),o=r.next(),a=i.next(),u=r.next();for(;s.value===o.value&&!a.done&&!u.done;)s=a,o=u,a=i.next(),u=r.next();for(this.toExit=s.value,this.toEnter=[o.value];!u.done;)this.toEnter.push(u.value),u=r.next();e instanceof n.PseudoState&&e.isHistory&&this.toEnter.pop()}doExitSource(t,e,i){this.toExit.doExit(t,e,i)}doEnterTarget(t,e,i){this.toEnter.forEach((n,r)=>n.doEnterHead(t,e,i,this.toEnter[r+1])),this.toEnter[this.toEnter.length-1].doEnterTail(t,e,i)}toString(){return"external"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InternalTransitionStrategy=void 0;const n=i(0);e.InternalTransitionStrategy=class{constructor(t,e){this.target=e}doEnterTarget(t,e,i){this.target instanceof n.State&&this.target.completion(t,e)}doExitSource(t,e,i){}toString(){return"internal"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LocalTransitionStrategy=void 0;e.LocalTransitionStrategy=class{constructor(t,e){this.source=t,this.target=e}doExitSource(t,e,i){for(this.vertexToEnter=this.target;this.vertexToEnter.parent&&this.vertexToEnter.parent.parent&&!this.vertexToEnter.parent.parent.isActive(t);)this.vertexToEnter=this.vertexToEnter.parent.parent;if(!this.vertexToEnter.isActive(t)&&this.vertexToEnter.parent){const n=t.getVertex(this.vertexToEnter.parent);n&&n.doExit(t,e,i)}}doEnterTarget(t,e,i){this.vertexToEnter&&!this.vertexToEnter.isActive(t)&&this.vertexToEnter.doEnter(t,e,i)}toString(){return"local"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Instance=void 0;const n=i(0),r=i(15);e.Instance=class{constructor(t,e){this.name=t,this.root=e,this.activeStateConfiguration=new Map,this.deferredEventPool=[],this.transactional(t=>{this.root.doEnter(t,!1,this.root),this.evaluateDeferred(t)})}evaluate(t){return n.log.write(()=>`${this} evaluate ${t}`,n.log.Evaluate),this.transaction?(this.defer(t),!1):this.transactional(e=>{const i=this.root.evaluate(e,!1,t);return i&&this.evaluateDeferred(e),i})}transactional(t){try{this.transaction=new r.Transaction(this);const e=t(this.transaction);for(const[t,e]of this.transaction.activeStateConfiguration)this.activeStateConfiguration.set(t,e);return e}finally{this.transaction=void 0}}defer(t){n.log.write(()=>`${this} deferring ${t}`,n.log.Evaluate),this.deferredEventPool.push(t)}evaluateDeferred(t){if(0!==this.deferredEventPool.length){for(let e=0;e<this.deferredEventPool.length;e++){const i=this.deferredEventPool[e];if(i&&-1===this.root.getDeferrableTriggers(t).indexOf(i.constructor)&&(delete this.deferredEventPool[e],n.log.write(()=>`${this} evaluate deferred ${i}`,n.log.Evaluate),this.root.evaluate(t,!1,i))){this.evaluateDeferred(t);break}}this.deferredEventPool=this.deferredEventPool.filter(t=>t)}}getState(t){return this.activeStateConfiguration.get(t)}toString(){return this.name}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transaction=void 0;e.Transaction=class{constructor(t){this.instance=t,this.activeStateConfiguration=new Map,this.lastKnownVertex=new Map}setState(t){t.parent&&this.activeStateConfiguration.set(t.parent,t)}getState(t){return this.activeStateConfiguration.get(t)||this.instance.getState(t)}setVertex(t){t.parent&&this.lastKnownVertex.set(t.parent,t)}getVertex(t){return this.lastKnownVertex.get(t)||this.instance.getState(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Visitor=void 0;e.Visitor=class{visitState(t){}visitStateTail(t){}visitPseudoState(t){}visitPseudoStateTail(t){}visitRegion(t){}visitRegionTail(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JSONSerializer=void 0;const n=i(0);class r{constructor(t){this.name=t.name}}class s extends r{constructor(){super(...arguments),this.children=[]}}class o extends r{constructor(t,e){super(t),this.activeState=e,this.children=[]}}class a extends n.Visitor{constructor(t,e){super(),this.instance=t,this.deferedEventSerializer=e,this.stateMap=new Map,this.regionMap=new Map}visitState(t){const e=new s(t);if(this.stateMap.set(t,e),void 0!==t.parent){const i=this.regionMap.get(t.parent);i&&i.children.push(e)}else this.root=e}visitRegion(t){const e=this.instance.getState(t),i=new o(t,e?e.name:void 0);this.regionMap.set(t,i);const n=this.stateMap.get(t.parent);n&&n.children.push(i)}toString(){return 0!==this.instance.deferredEventPool.length&&this.deferedEventSerializer&&this.root&&(this.root.deferredEventPool=this.instance.deferredEventPool.map(this.deferedEventSerializer)),JSON.stringify(this.root)}}e.JSONSerializer=a}]);